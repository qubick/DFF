<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Softness Design UI</title>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"></link>

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

		<!-- material search box -->
		<script type="text/javascript" src="https://cdn.rawgit.com/prashantchaudhary/ddslick/master/jquery.ddslick.min.js" ></script>

		<script type="javascript/text" src="server.js"></script>
	</head>

	<style>
				#sideBar {
					position:fixed;
					width:300px;
					height: 100%;
					top:0;
					left:0;
					/* background-color: white; */
					opacity: 0.8;
					/*overflow: auto;*/
  				overflow-y: scroll !important;
				}
				.thumbnail{
					width: 40px;
					height: 40px
				}
				.slider {
			    -webkit-appearance: none;
			    width: 100%;
			    height: 15px;
			    border-radius: 5px;
			    background: #d3d3d3;
			    outline: none;
			    opacity: 0.7;
			    -webkit-transition: .2s;
			    transition: opacity .2s;
			}
				#loadSTL {
					position: fixed;
					top: 105px;
					right: 0;
					width: 300px;
					height: 60px;
					background-color: grey;
					display: none;
				}
				.draggable{
					width: 150px
				}
			</style>

	<body>
		<div id="container" left="150px" top="0px" class="droppable">
			<script src="build/three.js"></script>
			<script src="build/csg.js"></script>
			<script src="build/ThreeCSG.js"></script>

			<script src="js/loaders/DDSLoader.js"></script>
			<script src="js/loaders/MTLLoader.js"></script>
			<script src="js/loaders/OBJLoader.js"></script>
			<script src="js/loaders/STLLoader.js"></script>
			<script src="js/Detector.js"></script>
			<script src="js/controls/OrbitControls.js"></script>
			<script src="js/libs/dat.gui.min.js"></script>
			<script src="js/libs/stats.min.js"></script>
			<script src="js/controls/DragControls.js"></script>
			<script src="js/controls/TrackballControls.js"></script>
			<script src="js/controls/TransformControls.js"></script>
			<script src="js/shaders/UnpackDepthRGBAShader.js"></script>
			<script src="js/utils/ShadowMapViewer.js"></script>
			<script src="js/exporters/STLExporter.js"></script>

			<script src="./event-handler.js"></script>
			<script src="./param-interface.js"></script>
			<script src="./editor.js"></script>
			<script src="./material.js"></script>
			<script src="./region-selection.js"></script>
			<script src="./refer-material.js"></script>
			<script src="./get2DVectors.js"></script>

			<div id="sideBar">

				<br/><br/><br/>
				Import 3D object:
				<input id="fileInput" type="file" name="files[]" onclick="handleFileSelect"/>

				<br/><br/>
				<select onchange="ReturnRegionSelecMethod(event)">
					<option value="0">Select Region</option>
					<option value="1">By Volume</option>
					<option value="2">By Type of Interaction</option>
					<option value="3">By Slicing in plane</option>
				</select>

				<br/><br/>
				<select onchange="ReturnDesiredInteraction(event)">
					<option value="0">Select Interaction</option>
					<option value="1">Foot Press</option>
			    <option value="2">Finger Press</option>
			    <option value="3">Sit</option>
			    <option value="4">Palm Grasp</option>
			    <option value="5">Finger Squeeze</option>
				</select>

				<br/><br/>
				<input type="text" id="searchBox" onclick="clickMaterials()" onkeyup="searchMaterial()" placeholder="Search for material">
				<div id="refer-material"></div>

				<div id="sliderlocation"></div>
				<div id="selectedMaterialImglocation"></div>

				<br/><br/>
				<select onchange="ReturnTypeofGradient(event)">
					<option value="0">Select Gradient Type</option>
					<option value="1">Binary</option>
			    <option value="2">Linear</option>
			    <option value="3">Radial</option>
				</select>

				<div id="gradientlocation"></div>
		</div>

		<script type="text/javascript">
			var softnessArray = [];
			var materialSelected = false;
			var softnessIdx = 0;

			function clickMaterials(){
				console.log("click material")

				var span = document.getElementsByTagName('span')[0].click()
				$('#refer-material').ddslick('open')
				// span.addClass('dd-pointer-up')
			}

			// enable search box
			function searchMaterial(){
				var input, filter, ul, li, a, i;
				input		= document.getElementById('searchBox');
				filter	= input.value.toUpperCase();
				ul = document.getElementsByClassName('dd-options')[0];
				li = ul.getElementsByTagName('li');


				for(i = 0; i < li.length; i++){
					a = li[i].getElementsByTagName("a")[0];

					if( a.innerHTML.toUpperCase().indexOf(filter) > -1){
						li[i].style.display = "";
					}
					else {
						li[i].style.display = "none";
					}
				} // end of for
			} //end of searchMaterial funcion

			$('#refer-material').ddslick({
					data: reference_material,
					width: 300,
					selectText: "Select preferred soft/hard materials",
					imagePosition: "right",
					onSelected: function(event){

						var softnessLevel = parseInt(event.selectedData.softness);
						softnessArray.push(softnessLevel);

						if( !materialSelected ){
							var input = document.createElement("input");

						  input.type = "range"
						  input.min = 0;
							input.max = 100;
							input.value = softnessArray[softnessIdx];
						  input.class = "slider"
						  input.id = "softnessRange"

						  var textInput = document.createElement("text");
						  textInput.value = '<br/> Shore A scale: ' + softnessArray[softnessIdx];
						  textInput.id = "shoreAScaleValue"

						  document.getElementById('sliderlocation').innerHTML = '<br/> Shore A scale: <div id="softnessValue"></div>'
						  document.getElementById('sliderlocation').appendChild(input);
							var output = document.getElementById("softnessValue")
							output.innerHTML = softnessArray[softnessIdx];

							//update value should be defined when the slider is actullay created
							var slider = document.getElementById("softnessRange");
							slider.oninput = function(){
								output = document.getElementById("softnessValue")
								output.innerHTML = this.value;
							}

							materialSelected = true;
						}
						else { // already input created and slider exists

							var inputSlider = document.getElementById('softnessRange')
							var outputText = document.getElementById("softnessValue")

							inputSlider.value = softnessArray[softnessIdx];
							outputText.innerHTML = softnessArray[softnessIdx];

						}
						//display reference material image on the slider bar
						var newImg = document.createElement("img");
						newImg.setAttribute("src", event.selectedData.imageSrc);
						newImg.setAttribute("class", "thumbnail");
						newImg.setAttribute("style", "position:absolute; left:" + softnessLevel * 10 + "px");
						document.getElementById("selectedMaterialImglocation").appendChild(newImg);

						console.log(newImg)
						softnessIdx++;
					}
				}); //eof ddslick
			// }); //eof foreach

			document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);

		</script>

		<input id="fileInput" type="file" name="files[]" style="visibility:hidden" />

	</body>
</html>
